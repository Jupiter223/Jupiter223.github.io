<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="认证服务-验证码短信 登录 注册与分布式session短信验证码第三方服务 此处使用阿里云 工具类 HttpUtilsHttpUtils 请从 https:&#x2F;&#x2F;github.com&#x2F;aliyun&#x2F;api-gateway-demo-sign-java&#x2F;blob&#x2F;master&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;aliyun&#x2F;api&#x2F;gateway&#x2F;demo&#x2F;util&#x2F;HttpUtils.java 或">
<meta property="og:type" content="article">
<meta property="og:title" content="认证服务-验证码短信 登录 注册与分布式session">
<meta property="og:url" content="http://example.com/2022/08/29/%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1-%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9F%AD%E4%BF%A1-%E7%99%BB%E5%BD%95-%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8Fsession/index.html">
<meta property="og:site_name" content="Jupiter">
<meta property="og:description" content="认证服务-验证码短信 登录 注册与分布式session短信验证码第三方服务 此处使用阿里云 工具类 HttpUtilsHttpUtils 请从 https:&#x2F;&#x2F;github.com&#x2F;aliyun&#x2F;api-gateway-demo-sign-java&#x2F;blob&#x2F;master&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;aliyun&#x2F;api&#x2F;gateway&#x2F;demo&#x2F;util&#x2F;HttpUtils.java 或">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1619865588369-2678e26b-0552-4d74-a43d-625123830f17.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_63,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10/resize,w_1125,limit_0">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1619869698249-e5700bbd-45a1-4213-bf24-00e1512a52ae.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_57,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620389591074-2418d369-493f-4194-9ce0-a3aa7b9fd532.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_63,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620390067762-1efaed64-a432-4ba1-b1ae-b783808dfd0c.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_63,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620650409677-0308820b-3621-4364-a198-9e2fb11bf9dc.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_58,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620650834542-f0a8cd6c-f60b-4040-ba04-7df375c747a7.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_57,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620650872790-56c092a2-fdfd-4431-81b5-889d2e5dfe37.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_57,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620650906562-303c9a7a-fec7-4dd0-b8e3-ce5ef31233bc.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_52,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1621678827735-65a003c7-4347-4b66-8eb2-398cc9f582c7.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_19,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1621688335508-22964e16-b818-4c06-b74a-7aa168e31711.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_29,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10/resize,w_1002,limit_0">
<meta property="article:published_time" content="2022-08-29T12:54:46.000Z">
<meta property="article:modified_time" content="2022-08-30T13:32:31.334Z">
<meta property="article:author" content="Jupiter">
<meta property="article:tag" content="视频笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2021/png/12568777/1619865588369-2678e26b-0552-4d74-a43d-625123830f17.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_63,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10/resize,w_1125,limit_0">

<link rel="canonical" href="http://example.com/2022/08/29/%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1-%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9F%AD%E4%BF%A1-%E7%99%BB%E5%BD%95-%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8Fsession/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>认证服务-验证码短信 登录 注册与分布式session | Jupiter</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Jupiter</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/29/%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1-%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9F%AD%E4%BF%A1-%E7%99%BB%E5%BD%95-%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8Fsession/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jupiter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jupiter">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          认证服务-验证码短信 登录 注册与分布式session
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-08-29 20:54:46" itemprop="dateCreated datePublished" datetime="2022-08-29T20:54:46+08:00">2022-08-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-08-30 21:32:31" itemprop="dateModified" datetime="2022-08-30T21:32:31+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index"><span itemprop="name">JAVA</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/GuliMall/" itemprop="url" rel="index"><span itemprop="name">GuliMall</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="认证服务-验证码短信-登录-注册与分布式session"><a href="#认证服务-验证码短信-登录-注册与分布式session" class="headerlink" title="认证服务-验证码短信 登录 注册与分布式session"></a>认证服务-验证码短信 登录 注册与分布式session</h1><h2 id="短信验证码"><a href="#短信验证码" class="headerlink" title="短信验证码"></a>短信验证码</h2><p>第三方服务 此处使用阿里云</p>
<h3 id="工具类-HttpUtils"><a href="#工具类-HttpUtils" class="headerlink" title="工具类 HttpUtils"></a>工具类 HttpUtils</h3><p>HttpUtils 请从 <a target="_blank" rel="noopener" href="https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/src/main/java/com/aliyun/api/gateway/demo/util/HttpUtils.java">https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/src/main/java/com/aliyun/api/gateway/demo/util/HttpUtils.java</a></p>
<p>或者直接下载：<a target="_blank" rel="noopener" href="http://code.fegine.com/HttpUtils.zip">http://code.fegine.com/HttpUtils.zip</a></p>
<p>之前用阿里云测试写的</p>
<span id="more"></span>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsmApiServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MsmApiService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">send</span><span class="params">(String phone, Map&lt;String, Object&gt; param)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// HttpClient Configuration</span></span><br><span class="line">        <span class="comment">/*HttpClient httpClient = new ApacheAsyncHttpClientBuilder()</span></span><br><span class="line"><span class="comment">                .connectionTimeout(Duration.ofSeconds(10)) // Set the connection timeout time, the default is 10 seconds</span></span><br><span class="line"><span class="comment">                .responseTimeout(Duration.ofSeconds(10)) // Set the response timeout time, the default is 20 seconds</span></span><br><span class="line"><span class="comment">                .maxConnections(128) // Set the connection pool size</span></span><br><span class="line"><span class="comment">                .maxIdleTimeOut(Duration.ofSeconds(50)) // Set the connection pool timeout, the default is 30 seconds</span></span><br><span class="line"><span class="comment">                // Configure the proxy</span></span><br><span class="line"><span class="comment">                .proxy(new ProxyOptions(ProxyOptions.Type.HTTP, new InetSocketAddress(&quot;&lt;your-proxy-hostname&gt;&quot;, 9001))</span></span><br><span class="line"><span class="comment">                        .setCredentials(&quot;&lt;your-proxy-username&gt;&quot;, &quot;&lt;your-proxy-password&gt;&quot;))</span></span><br><span class="line"><span class="comment">                // If it is an https connection, you need to configure the certificate, or ignore the certificate(.ignoreSSL(true))</span></span><br><span class="line"><span class="comment">                .x509TrustManagers(new X509TrustManager[]&#123;&#125;)</span></span><br><span class="line"><span class="comment">                .keyManagers(new KeyManager[]&#123;&#125;)</span></span><br><span class="line"><span class="comment">                .ignoreSSL(false)</span></span><br><span class="line"><span class="comment">                .build();*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Configure Credentials authentication information, including ak, secret, token</span></span><br><span class="line">        <span class="type">StaticCredentialProvider</span> <span class="variable">provider</span> <span class="operator">=</span> StaticCredentialProvider.create(Credential.builder()</span><br><span class="line">                .accessKeyId(<span class="string">&quot;&quot;</span>)</span><br><span class="line">                .accessKeySecret(<span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="comment">//.securityToken(&quot;&lt;your-token&gt;&quot;) // use STS token</span></span><br><span class="line">                .build());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Configure the Client</span></span><br><span class="line">        <span class="type">AsyncClient</span> <span class="variable">client</span> <span class="operator">=</span> AsyncClient.builder()</span><br><span class="line">                .region(<span class="string">&quot;cn-hangzhou&quot;</span>) <span class="comment">// Region ID</span></span><br><span class="line">                <span class="comment">//.httpClient(httpClient) // Use the configured HttpClient, otherwise use the default HttpClient (Apache HttpClient)</span></span><br><span class="line">                .credentialsProvider(provider)</span><br><span class="line">                <span class="comment">//.serviceConfiguration(Configuration.create()) // Service-level configuration</span></span><br><span class="line">                <span class="comment">// Client-level configuration rewrite, can set Endpoint, Http request parameters, etc.</span></span><br><span class="line">                .overrideConfiguration(</span><br><span class="line">                        ClientOverrideConfiguration.create()</span><br><span class="line">                                .setEndpointOverride(<span class="string">&quot;dysmsapi.aliyuncs.com&quot;</span>)</span><br><span class="line">                        <span class="comment">//.setReadTimeout(Duration.ofSeconds(30))</span></span><br><span class="line">                )</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Parameter settings for API request</span></span><br><span class="line">        <span class="type">SendSmsRequest</span> <span class="variable">sendSmsRequest</span> <span class="operator">=</span> SendSmsRequest.builder()</span><br><span class="line">                .signName(<span class="string">&quot;阿里云短信测试&quot;</span>)</span><br><span class="line">                .templateCode(<span class="string">&quot;SMS_154950909&quot;</span>)</span><br><span class="line">                .phoneNumbers(phone)</span><br><span class="line">                .templateParam(JSONObject.toJSONString(param))</span><br><span class="line">                <span class="comment">// Request-level configuration rewrite, can set Http request parameters, etc.</span></span><br><span class="line">                <span class="comment">// .requestConfiguration(RequestConfiguration.create().setHttpHeaders(new HttpHeaders()))</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Asynchronously get the return value of the API request</span></span><br><span class="line">            CompletableFuture&lt;SendSmsResponse&gt; response = client.sendSms(sendSmsRequest);</span><br><span class="line">            <span class="comment">// Synchronously get the return value of the API request</span></span><br><span class="line">            <span class="type">SendSmsResponse</span> <span class="variable">resp</span> <span class="operator">=</span> response.get();</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">Gson</span>().toJson(resp));</span><br><span class="line">            <span class="comment">// Asynchronous processing of return values</span></span><br><span class="line">        <span class="comment">/*response.thenAccept(resp -&gt; &#123;</span></span><br><span class="line"><span class="comment">            System.out.println(new Gson().toJson(resp));</span></span><br><span class="line"><span class="comment">        &#125;).exceptionally(throwable -&gt; &#123; // Handling exceptions</span></span><br><span class="line"><span class="comment">            System.out.println(throwable.getMessage());</span></span><br><span class="line"><span class="comment">            return null;</span></span><br><span class="line"><span class="comment">        &#125;);*/</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// Finally, close the client</span></span><br><span class="line">            <span class="keyword">return</span>  <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e1) &#123;</span><br><span class="line">            e1.printStackTrace();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e2) &#123;</span><br><span class="line">            e2.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="相关配置"><a href="#相关配置" class="headerlink" title="相关配置"></a>相关配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: <span class="number">192.168</span><span class="number">.163</span><span class="number">.131</span>:<span class="number">8848</span></span><br><span class="line">    alicloud:</span><br><span class="line">      sms:</span><br><span class="line">        host: https:<span class="comment">//fesms.market.alicloudapi.com</span></span><br><span class="line">        path: /sms/</span><br><span class="line">        skin: <span class="number">1</span></span><br><span class="line">        sign: <span class="number">175622</span></span><br><span class="line">        appcode: 93b7e19861a24c519a7548b17dc16d75</span><br></pre></td></tr></table></figure>

<h3 id="发送验证码"><a href="#发送验证码" class="headerlink" title="发送验证码"></a>发送验证码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.cloud.alicloud.sms&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line">    <span class="keyword">private</span> String skin;</span><br><span class="line">    <span class="keyword">private</span> String sign;</span><br><span class="line">    <span class="keyword">private</span> String appcode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCode</span><span class="params">(String phone, String code)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> <span class="string">&quot;GET&quot;</span>;</span><br><span class="line">        Map&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 最后在header中的格式(中间是英文空格)为 Authorization:APPCODE 93b7e19861a24c519a7548b17dc16d75</span></span><br><span class="line">        headers.put(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;APPCODE &quot;</span> + appcode);</span><br><span class="line">        Map&lt;String, String&gt; queries = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">        queries.put(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">        queries.put(<span class="string">&quot;phone&quot;</span>, phone);</span><br><span class="line">        queries.put(<span class="string">&quot;skin&quot;</span>, skin);</span><br><span class="line">        queries.put(<span class="string">&quot;sign&quot;</span>, sign);</span><br><span class="line">        <span class="comment">//JDK 1.8示例代码请在这里下载：  http://code.fegine.com/Tools.zip</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> HttpUtils.doGet(host, path, method, headers, queries);</span><br><span class="line">            <span class="comment">//System.out.println(response.toString());如不输出json, 请打开这行代码，打印调试头部状态码。</span></span><br><span class="line">            <span class="comment">//状态码: 200 正常；400 URL无效；401 appCode错误； 403 次数用完； 500 API网管错误</span></span><br><span class="line">            <span class="comment">//获取response的body</span></span><br><span class="line">            System.out.println(EntityUtils.toString(response.getEntity()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendSmsCode</span><span class="params">()</span> &#123;</span><br><span class="line">        smsComponent.sendCode(<span class="string">&quot;13838383838&quot;</span>, <span class="string">&quot;134531&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="发送短信接口"><a href="#发送短信接口" class="headerlink" title="发送短信接口"></a>发送短信接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/sms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsSendController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsComponent smsComponent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提供给别的服务进行调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phone</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/sendCode&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">sendCode</span><span class="params">(<span class="meta">@RequestParam(&quot;phone&quot;)</span> String phone, <span class="meta">@RequestParam(&quot;code&quot;)</span> String code)</span> &#123;</span><br><span class="line">        <span class="comment">//发送验证码</span></span><br><span class="line">        smsComponent.sendCode(phone,code);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="接口防刷和验证码再次校验"><a href="#接口防刷和验证码再次校验" class="headerlink" title="接口防刷和验证码再次校验"></a>接口防刷和验证码再次校验</h3><p>mall-auth-server LoginController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/sms/sendCode&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">sendCode</span><span class="params">(<span class="meta">@RequestParam(&quot;phone&quot;)</span> String phone)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1、接口防刷</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">redisCode</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(AuthServerConstant.SMS_CODE_CACHE_PREFIX + phone);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(redisCode)) &#123;</span><br><span class="line">        <span class="comment">//活动存入redis的时间，用当前时间减去存入redis的时间，判断用户手机号是否在60s内发送验证码</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> Long.parseLong(redisCode.split(<span class="string">&quot;_&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (System.currentTimeMillis() - currentTime &lt; <span class="number">60000</span>) &#123;</span><br><span class="line">            <span class="comment">//60s内不能再发</span></span><br><span class="line">            <span class="keyword">return</span> R.error(BizCodeEnum.SMS_CODE_EXCEPTION.getCode(), BizCodeEnum.SMS_CODE_EXCEPTION.getMsg());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、验证码的再次效验 redis.存key-phone,value-code</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> (<span class="type">int</span>) ((Math.random() * <span class="number">9</span> + <span class="number">1</span>) * <span class="number">100000</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">codeNum</span> <span class="operator">=</span> String.valueOf(code);</span><br><span class="line">    <span class="type">String</span> <span class="variable">redisStorage</span> <span class="operator">=</span> codeNum + <span class="string">&quot;_&quot;</span> + System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//存入redis，防止同一个手机号在60秒内再次发送验证码 key sms:code:130xxxxxxx value：123456_timemillis</span></span><br><span class="line">    <span class="comment">//即使redis有数据 也不能保证第三方一定把短信发出去了</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(AuthServerConstant.SMS_CODE_CACHE_PREFIX + phone,</span><br><span class="line">                                          redisStorage, <span class="number">10</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//feign调用</span></span><br><span class="line">    thirdPartFeignService.sendCode(phone, codeNum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.guli.common.constant;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthServerConstant</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SMS_CODE_CACHE_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;sms:code:&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOGIN_USER</span> <span class="operator">=</span> <span class="string">&quot;loginUser&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h2><p>使用JSR303校验</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRegisterVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;用户名不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Length(min = 6, max = 19, message=&quot;用户名长度在6-18字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;密码必须填写&quot;)</span></span><br><span class="line">    <span class="meta">@Length(min = 6,max = 18,message = &quot;密码必须是6—18位字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;手机号不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^[1]([3-9])[0-9]&#123;9&#125;$&quot;, message = &quot;手机号格式不正确&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;验证码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需加上@Valid注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@PostMapping(value = &quot;/register&quot;)</span></span><br><span class="line">hasErrors() 可以判断是否有参数校验错误，如果有，可以通过 getFieldsErrors() 方法获取错误列表。</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">register</span><span class="params">(<span class="meta">@Valid</span> UserRegisterVo vos, BindingResult result, RedirectAttributes attributes)</span> &#123;</span><br><span class="line">    <span class="comment">//而校验的结果，也会自动封装到 BindingResult 类型中，通过这个参数可以很方便的对错误的参数进行处理。   </span></span><br><span class="line">    <span class="comment">//如果有错误回到注册页面 </span></span><br><span class="line">    <span class="comment">//hasErrors() 可以判断是否有参数校验错误，如果有，可以通过 getFieldsErrors() 方法获取错误列表。</span></span><br><span class="line">    <span class="comment">//注意：@Valid 和 BindingResult 是一一对应的，多个 @Valid 标注的参数实体后面要对应各自的 BindingResult.</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (result.hasErrors()) &#123;</span><br><span class="line">            Map&lt;String, String&gt; errors = result.getFieldErrors().stream().collect(Collectors.toMap(FieldError::getField, FieldError::getDefaultMessage));</span><br><span class="line">            attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">            <span class="comment">//效验出错回到注册页面</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、效验验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> vos.getCode();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取存入Redis里的验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redisCode</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(AuthServerConstant.SMS_CODE_CACHE_PREFIX + vos.getPhone());</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(redisCode)) &#123;</span><br><span class="line">            <span class="comment">//截取字符串</span></span><br><span class="line">            <span class="keyword">if</span> (code.equals(redisCode.split(<span class="string">&quot;_&quot;</span>)[<span class="number">0</span>])) &#123;</span><br><span class="line">                <span class="comment">//删除验证码;令牌机制</span></span><br><span class="line">                stringRedisTemplate.delete(AuthServerConstant.SMS_CODE_CACHE_PREFIX + vos.getPhone());</span><br><span class="line">                <span class="comment">//验证码通过，真正注册，调用远程服务进行注册</span></span><br><span class="line">                <span class="type">R</span> <span class="variable">register</span> <span class="operator">=</span> memberFeignService.register(vos);</span><br><span class="line">                <span class="keyword">if</span> (register.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//成功</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/login.html&quot;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//失败</span></span><br><span class="line">                    Map&lt;String, String&gt; errors = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                    errors.put(<span class="string">&quot;msg&quot;</span>, register.getData(<span class="string">&quot;msg&quot;</span>, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;String&gt;() &#123;</span><br><span class="line">                    &#125;));</span><br><span class="line">                    attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//效验出错回到注册页面</span></span><br><span class="line">                Map&lt;String, String&gt; errors = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                errors.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">                attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//效验出错回到注册页面</span></span><br><span class="line">            Map&lt;String, String&gt; errors = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            errors.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">            attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/login.html&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">loginPage</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//从session先取出来用户的信息，判断用户是否已经登录过了</span></span><br><span class="line">       <span class="type">Object</span> <span class="variable">attribute</span> <span class="operator">=</span> session.getAttribute(LOGIN_USER);</span><br><span class="line">       <span class="comment">//如果用户没登录那就跳转到登录页面</span></span><br><span class="line">       <span class="keyword">if</span> (attribute == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;redirect:http://gulimall.com&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="meta">@PostMapping(value = &quot;/login&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(UserLoginVo vo, RedirectAttributes attributes, HttpSession session)</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//远程登录member服务</span></span><br><span class="line">       <span class="type">R</span> <span class="variable">login</span> <span class="operator">=</span> memberFeignService.login(vo);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (login.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="type">MemberResponseVo</span> <span class="variable">data</span> <span class="operator">=</span> login.getData(<span class="string">&quot;data&quot;</span>, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;MemberResponseVo&gt;() &#123;</span><br><span class="line">           &#125;);</span><br><span class="line">           session.setAttribute(LOGIN_USER, data);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;redirect:http://gulimall.com&quot;</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           Map&lt;String, String&gt; errors = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">           errors.put(<span class="string">&quot;msg&quot;</span>, login.getData(<span class="string">&quot;msg&quot;</span>, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;String&gt;() &#123;</span><br><span class="line">           &#125;));</span><br><span class="line">           attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/login.html&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>member模块 controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> MemberLoginVo loginVo)</span> &#123;</span><br><span class="line">      MemberEntity entity=memberService.login(loginVo);</span><br><span class="line">      <span class="keyword">if</span> (entity!=<span class="literal">null</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> R.ok().put(<span class="string">&quot;memberEntity&quot;</span>,entity);</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> R.error(BizCodeEnum.LOGINACCT_PASSWORD_EXCEPTION.getCode(), BizCodeEnum.LOGINACCT_PASSWORD_EXCEPTION.getMsg());</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/register&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">register</span><span class="params">(<span class="meta">@RequestBody</span> MemberRegisterVo registerVo)</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           memberService.register(registerVo);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (UserExistException userException) &#123;</span><br><span class="line">           <span class="keyword">return</span> R.error(BizCodeEnum.USER_EXIST_EXCEPTION.getCode(), BizCodeEnum.USER_EXIST_EXCEPTION.getMsg());</span><br><span class="line">       &#125; <span class="keyword">catch</span> (PhoneNumExistException phoneException) &#123;</span><br><span class="line">           <span class="keyword">return</span> R.error(BizCodeEnum.PHONE_EXIST_EXCEPTION.getCode(), BizCodeEnum.PHONE_EXIST_EXCEPTION.getMsg());</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> R.ok();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>member模块 service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> MemberEntity <span class="title function_">login</span><span class="params">(MemberLoginVo loginVo)</span> &#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">loginAccount</span> <span class="operator">=</span> loginVo.getLoginAccount();</span><br><span class="line">       <span class="comment">//以用户名或电话号登录的进行查询</span></span><br><span class="line">       <span class="type">MemberEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="built_in">this</span>.getOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;MemberEntity&gt;().eq(<span class="string">&quot;username&quot;</span>, loginAccount).or().eq(<span class="string">&quot;mobile&quot;</span>, loginAccount));</span><br><span class="line">       <span class="keyword">if</span> (entity!=<span class="literal">null</span>)&#123;<span class="comment">//MD5盐值加密后验证密码</span></span><br><span class="line">           <span class="type">BCryptPasswordEncoder</span> <span class="variable">bCryptPasswordEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();<span class="comment">//mathes(前面明文，后编码后的密码)</span></span><br><span class="line">           <span class="type">boolean</span> <span class="variable">matches</span> <span class="operator">=</span> bCryptPasswordEncoder.matches(loginVo.getPassword(), entity.getPassword());</span><br><span class="line">           <span class="keyword">if</span> (matches)&#123;</span><br><span class="line">               entity.setPassword(<span class="string">&quot;&quot;</span>);</span><br><span class="line">               <span class="keyword">return</span> entity;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(MemberRegisterVo registerVo)</span> &#123;</span><br><span class="line">        <span class="comment">//1 检查电话号是否唯一</span></span><br><span class="line">        checkPhoneUnique(registerVo.getPhone());</span><br><span class="line">        <span class="comment">//2 检查用户名是否唯一</span></span><br><span class="line">        checkUserNameUnique(registerVo.getUserName());</span><br><span class="line">        <span class="comment">//3 该用户信息唯一，进行插入</span></span><br><span class="line">        <span class="type">MemberEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MemberEntity</span>();</span><br><span class="line">        <span class="comment">//3.1 保存基本信息</span></span><br><span class="line">        entity.setUsername(registerVo.getUserName());</span><br><span class="line">        entity.setMobile(registerVo.getPhone());</span><br><span class="line">        entity.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="comment">//3.2 使用加密保存密码</span></span><br><span class="line">        <span class="type">BCryptPasswordEncoder</span> <span class="variable">passwordEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">encodePassword</span> <span class="operator">=</span> passwordEncoder.encode(registerVo.getPassword());</span><br><span class="line">        entity.setPassword(encodePassword);</span><br><span class="line">        <span class="comment">//3.3 设置会员默认等级</span></span><br><span class="line">        <span class="comment">//3.3.1 找到会员默认登记</span></span><br><span class="line">        <span class="type">MemberLevelEntity</span> <span class="variable">defaultLevel</span> <span class="operator">=</span> memberLevelService.getOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;MemberLevelEntity&gt;().eq(<span class="string">&quot;default_status&quot;</span>, <span class="number">1</span>));</span><br><span class="line">        <span class="comment">//3.3.2 设置会员等级为默认</span></span><br><span class="line">        entity.setLevelId(defaultLevel.getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 保存用户信息</span></span><br><span class="line">        <span class="built_in">this</span>.save(entity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="MD5-amp-MD5盐值加密"><a href="#MD5-amp-MD5盐值加密" class="headerlink" title="MD5&amp;MD5盐值加密"></a>MD5&amp;MD5盐值加密</h1><h2 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h2><p>Message Digest algorithm 5，信息摘要算法</p>
<ul>
<li>压缩性：任意长度的数据，算出的 MD5 值长度都是固定的；（应用场景 秒传功能）</li>
<li>容易计算：从原数据计算出 MD5 值很容易；</li>
<li>抗修改性：对原数据进行任何改动，哪怕只修改 1 个字节，所得到的 MD5 值都有很大区别；</li>
<li>强抗碰撞：想找到两个不同的数据，使它们具有相同的 MD5 值是非常困难的；</li>
<li>不可逆</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> DigestUtils.md5Hex(<span class="string">&quot;123456&quot;</span>);<span class="comment">//apache.commons包里</span></span><br><span class="line">    System.out.println(s);</span><br><span class="line">    <span class="comment">// 盐值加密 MD5不能直接加密后放数据库 怕暴力破解</span></span><br><span class="line">    System.out.println(Md5Crypt.md5Crypt(<span class="string">&quot;123456&quot;</span>.getBytes()));<span class="comment">///apache.commons包里</span></span><br><span class="line">    System.out.println(Md5Crypt.md5Crypt(<span class="string">&quot;123456&quot;</span>.getBytes(), <span class="string">&quot;$1$qqqqqqqq&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Spring 盐值加密 密码编码器</span></span><br><span class="line">    <span class="type">BCryptPasswordEncoder</span> <span class="variable">bCryptPasswordEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    <span class="comment">//$2a$10$GT0TjB5YK5Vx77Y.2N7hkuYZtYAjZjMlE6NWGE2Aar/7pk/Rmhf8S</span></span><br><span class="line">    <span class="comment">//$2a$10$cR3lis5HQQsQSSh8/c3L3ujIILXkVYmlw28vLA39xz4mHDN/NBVUi</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">encode</span> <span class="operator">=</span> bCryptPasswordEncoder.encode(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">matches</span> <span class="operator">=</span> bCryptPasswordEncoder.matches(<span class="string">&quot;123456&quot;</span>, <span class="string">&quot;$2a$10$GT0TjB5YK5Vx77Y.2N7hkuYZtYAjZjMlE6NWGE2Aar/7pk/Rmhf8S&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(encode + <span class="string">&quot;==&gt;&quot;</span> + matches);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.gulimall.common.exception;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 错误码和错误信息定义类</span></span><br><span class="line"><span class="comment"> * 1. 错误码定义规则为5为数字</span></span><br><span class="line"><span class="comment"> * 2. 前两位表示业务场景，最后三位表示错误码。例如：100001。10:通用 001:系统未知异常</span></span><br><span class="line"><span class="comment"> * 3. 维护错误码后需要维护错误描述，将他们定义为枚举形式</span></span><br><span class="line"><span class="comment"> * 错误码列表：</span></span><br><span class="line"><span class="comment"> *  10: 通用</span></span><br><span class="line"><span class="comment"> *      001：参数格式校验</span></span><br><span class="line"><span class="comment"> *  11: 商品</span></span><br><span class="line"><span class="comment"> *  12: 订单</span></span><br><span class="line"><span class="comment"> *  13: 购物车</span></span><br><span class="line"><span class="comment"> *  14: 物流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">BizCodeEnum</span> &#123;</span><br><span class="line"></span><br><span class="line">    UNKNOW_EXCEPTION(<span class="number">10000</span>,<span class="string">&quot;系统未知异常&quot;</span>),</span><br><span class="line">    VAILD_EXCEPTION(<span class="number">10001</span>,<span class="string">&quot;参数格式校验失败&quot;</span>),</span><br><span class="line">    TO_MANY_REQUEST(<span class="number">10002</span>,<span class="string">&quot;请求流量过大，请稍后再试&quot;</span>),</span><br><span class="line">    SMS_CODE_EXCEPTION(<span class="number">10003</span>,<span class="string">&quot;验证码获取频率太高，请稍后再试&quot;</span>),</span><br><span class="line">    READ_TIME_OUT_EXCEPTION(<span class="number">10004</span>,<span class="string">&quot;远程调用服务超时，请重新再试&quot;</span>),</span><br><span class="line">    SECKILL_EXCEPTION(<span class="number">10005</span>,<span class="string">&quot;秒杀请求过多，请重新再试&quot;</span>),</span><br><span class="line">    PRODUCT_UP_EXCEPTION(<span class="number">11000</span>,<span class="string">&quot;商品上架异常&quot;</span>),</span><br><span class="line">    USER_EXIST_EXCEPTION(<span class="number">15001</span>,<span class="string">&quot;存在相同的用户&quot;</span>),</span><br><span class="line">    PHONE_EXIST_EXCEPTION(<span class="number">15002</span>,<span class="string">&quot;存在相同的手机号&quot;</span>),</span><br><span class="line">    NO_STOCK_EXCEPTION(<span class="number">21000</span>,<span class="string">&quot;商品库存不足&quot;</span>),</span><br><span class="line">    LOGINACCT_PASSWORD_EXCEPTION(<span class="number">15003</span>,<span class="string">&quot;账号或密码错误&quot;</span>),;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    BizCodeEnum(<span class="type">int</span> code, String msg) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Oauth2-0"><a href="#Oauth2-0" class="headerlink" title="Oauth2.0"></a>Oauth2.0</h1><p>●OAuth： ： OAuth（开放授权）是一个开放标准，允许用户授权第三方网站访问他们存储在另外的服务提供者上的信息，而不需要将用户名和密码提供给第三方网站或分享他们数据的所有内容。<br>●OAuth2.0 ：对于用户相关的 OpenAPI（例如获取用户信息，动态同步，照片，日志，分享等），为了保护用户数据的安全和隐私，第三方网站访问用户数据前都需要显式的向用户征求授权。</p>
<p>授权流程图示：</p>
<p>OAuth2.0</p>
<p>2,用户授权</p>
<p>(输入自己的</p>
<p>社交账号密码)</p>
<p>1,向用户申请请求认证</p>
<p>resourceowner</p>
<p>本人</p>
<p>client</p>
<p>3,使用上步接权,进行认证</p>
<p>CSDN等</p>
<p>AuthorizationServer</p>
<p>第三方应用</p>
<p>QQ服务器</p>
<p>4,认证通过,返回访问令牌</p>
<p>ResourceServer</p>
<p>使用访问令牌,获取开放保护信息</p>
<p>QQ服务器</p>
<p>6,认证令牌,返回受保护信息</p>
<p>1,使用Code换取AccessToken,Code只能用一次</p>
<p>2,同一个用户的accessToken一段时间是不会变化的,即使多次获取</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/12568777/1619865588369-2678e26b-0552-4d74-a43d-625123830f17.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_63,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10/resize,w_1125,limit_0" alt="image.png"></p>
<h2 id="接入步骤"><a href="#接入步骤" class="headerlink" title="接入步骤"></a>接入步骤</h2><p>以微博为例：</p>
<p>1.引导用户到微博的认证地址：<a target="_blank" rel="noopener" href="https://api.weibo.com/oauth2/authorize?client_id=YOUR_CLIENT_ID&amp;response_type=code&amp;redirect_uri=YOUR_REGISTERED_REDIRECT_URI">https://api.weibo.com/oauth2/authorize?client_id=YOUR_CLIENT_ID&amp;response_type=code&amp;redirect_uri=YOUR_REGISTERED_REDIRECT_URI</a></p>
<p>●client_id：微博网站接入提供的 APP KEY；</p>
<p>●redirect_uri：认证后重定向的地址；</p>
<p>2.用户同意授权重定向到上面设置的地址并携带 code：<a target="_blank" rel="noopener" href="http://www.gulimall.com/success?code=CODE%EF%BC%9B">http://www.gulimall.com/success?code=CODE；</a></p>
<p>3.使用 code 请求微博提供的地址换取 access_token：<a target="_blank" rel="noopener" href="https://api.weibo.com/oauth2/access_token?client_id=YOUR_CLIENT_ID&amp;client_secret=YOUR_CLIENT_SECRET&amp;grant_type=authorization_code&amp;redirect_uri=YOUR_REGISTERED_REDIRECT_URI&amp;code=CODE">https://api.weibo.com/oauth2/access_token?client_id=YOUR_CLIENT_ID&amp;client_secret=YOUR_CLIENT_SECRET&amp;grant_type=authorization_code&amp;redirect_uri=YOUR_REGISTERED_REDIRECT_URI&amp;code=CODE</a></p>
<p>●client_id：APP KEY；</p>
<p>●client_secret：APP SECRET；</p>
<p>●redirect_uri：认证后重定向的地址 <a target="_blank" rel="noopener" href="http://www.gulimall.com/success">http://www.gulimall.com/success</a></p>
<p>●code：第二步返回的 code 值；</p>
<p>●返回响应报文：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;access_token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.00pDpxyGd3J5bEef6b98778e0ZKsu4&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;remind_in&quot;</span><span class="punctuation">:</span> <span class="string">&quot;157679999&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;expires_in&quot;</span><span class="punctuation">:</span> <span class="number">157679999</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6397634785&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;isRealName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>4.根据 access_token 可以获取微博提供的公共接口数据；</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/12568777/1619869698249-e5700bbd-45a1-4213-bf24-00e1512a52ae.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_57,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OauthController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberFeignService memberFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/oauth2.0/weibo/success&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">authorize</span><span class="params">(String code, HttpSession session)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1. 使用code换取token，换取成功则继续2，否则重定向至登录页</span></span><br><span class="line">        Map&lt;String, String&gt; query = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        query.put(<span class="string">&quot;client_id&quot;</span>, <span class="string">&quot;2144471074&quot;</span>);</span><br><span class="line">        query.put(<span class="string">&quot;client_secret&quot;</span>, <span class="string">&quot;ff63a0d8d591a85a29a19492817316ab&quot;</span>);<span class="comment">//密码</span></span><br><span class="line">        query.put(<span class="string">&quot;grant_type&quot;</span>, <span class="string">&quot;authorization_code&quot;</span>);</span><br><span class="line">        query.put(<span class="string">&quot;redirect_uri&quot;</span>, <span class="string">&quot;http://auth.gulimall.com/oauth2.0/weibo/success&quot;</span>);</span><br><span class="line">        query.put(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">        <span class="comment">//发送post请求换取token</span></span><br><span class="line">        <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> HttpUtils.doPost(<span class="string">&quot;https://api.weibo.com&quot;</span>, <span class="string">&quot;/oauth2/access_token&quot;</span>, <span class="string">&quot;post&quot;</span>, <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;(), query, <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;());</span><br><span class="line">        Map&lt;String, String&gt; errors = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="comment">//2. 调用member远程接口进行oauth登录，登录成功则转发至首页并携带返回用户信息，否则转发至登录页</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity());</span><br><span class="line">            <span class="type">SocialUser</span> <span class="variable">socialUser</span> <span class="operator">=</span> JSON.parseObject(json, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;SocialUser&gt;() &#123;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="type">R</span> <span class="variable">login</span> <span class="operator">=</span> memberFeignService.login(socialUser);</span><br><span class="line">            <span class="comment">//2.1 远程调用成功，返回首页并携带用户信息</span></span><br><span class="line">            <span class="keyword">if</span> (login.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> JSON.toJSONString(login.get(<span class="string">&quot;memberEntity&quot;</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;----------------&quot;</span>+jsonString);</span><br><span class="line">                <span class="type">MemberResponseVo</span> <span class="variable">memberResponseVo</span> <span class="operator">=</span> JSON.parseObject(jsonString, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;MemberResponseVo&gt;() &#123;</span><br><span class="line">                &#125;);</span><br><span class="line">                System.out.println(<span class="string">&quot;----------------&quot;</span>+memberResponseVo);</span><br><span class="line">                session.setAttribute(AuthServerConstant.LOGIN_USER, memberResponseVo);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;redirect:http://gulimall.com&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//2.2 否则返回登录页</span></span><br><span class="line">                errors.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;登录失败，请重试&quot;</span>);</span><br><span class="line">                session.setAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/login.html&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            errors.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;获得第三方授权失败，请重试&quot;</span>);</span><br><span class="line">            session.setAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/login.html&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>google账号社交登录</p>
<p><a target="_blank" rel="noopener" href="https://developers.google.com/identity/gsi/web">https://developers.google.com/identity/gsi/web</a></p>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="Session-共享问题"><a href="#Session-共享问题" class="headerlink" title="Session 共享问题"></a>Session 共享问题</h1><h2 id="Session-原理"><a href="#Session-原理" class="headerlink" title="Session 原理"></a>Session 原理</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620389591074-2418d369-493f-4194-9ce0-a3aa7b9fd532.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_63,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" alt="img"></p>
<p>登录在auth服务器,成功后到gulimall无法共享,或者在其他服务器无法共享</p>
<h2 id="分布式下-Session-共享问题"><a href="#分布式下-Session-共享问题" class="headerlink" title="分布式下 Session 共享问题"></a>分布式下 Session 共享问题</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620390067762-1efaed64-a432-4ba1-b1ae-b783808dfd0c.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_63,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" alt="img"></p>
<h1 id="Session-共享问题解决"><a href="#Session-共享问题解决" class="headerlink" title="Session 共享问题解决"></a>Session 共享问题解决</h1><h2 id="Session-复制"><a href="#Session-复制" class="headerlink" title="Session 复制"></a>Session 复制</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620650409677-0308820b-3621-4364-a198-9e2fb11bf9dc.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_58,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" alt="img"></p>
<h2 id="客户端存储"><a href="#客户端存储" class="headerlink" title="客户端存储"></a>客户端存储</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620650834542-f0a8cd6c-f60b-4040-ba04-7df375c747a7.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_57,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" alt="img"></p>
<h2 id="hash一致性"><a href="#hash一致性" class="headerlink" title="hash一致性"></a>hash一致性</h2><p>同一个ip落到同一个服务器</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620650872790-56c092a2-fdfd-4431-81b5-889d2e5dfe37.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_57,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" alt="img"></p>
<h2 id="统一存储"><a href="#统一存储" class="headerlink" title="统一存储"></a>统一存储</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12568777/1620650906562-303c9a7a-fec7-4dd0-b8e3-ce5ef31233bc.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_52,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" alt="img"></p>
<h1 id="整合SpringSession"><a href="#整合SpringSession" class="headerlink" title="整合SpringSession"></a>整合SpringSession</h1><h2 id="SpringBoot-整合-SpringSession"><a href="#SpringBoot-整合-SpringSession" class="headerlink" title="SpringBoot 整合 SpringSession"></a>SpringBoot 整合 SpringSession</h2><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-session/docs/2.5.0/reference/html5/#samples">https://docs.spring.io/spring-session/docs/2.5.0/reference/html5/#samples</a></p>
<p>auth 服务、product 服务、 search 服务 pom文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 整合 spring session 实现 session 共享--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>配置文件 application.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">session:</span></span><br><span class="line">    <span class="attr">store-type:</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure>

<p>主启动类增加注解：@EnableRedisHttpSession </p>
<p>配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GulimallSessionConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CookieSerializer <span class="title function_">cookieSerializer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultCookieSerializer</span> <span class="variable">cookieSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultCookieSerializer</span>();</span><br><span class="line">        <span class="comment">//放大作用域 如在子域登录成功 放大到全域</span></span><br><span class="line">        cookieSerializer.setDomainName(<span class="string">&quot;gulimall.com&quot;</span>);</span><br><span class="line">        cookieSerializer.setCookieName(<span class="string">&quot;GULISESSION&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> cookieSerializer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisSerializer&lt;Object&gt; <span class="title function_">springSessionDefaultRedisSerializer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>();<span class="comment">//用json的方式序列化对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="SpringSession-核心原理"><a href="#SpringSession-核心原理" class="headerlink" title="SpringSession 核心原理"></a>SpringSession 核心原理</h2><p>@EnableRedisHttpSession 导入 RedisHttpSessionConfiguration 配置</p>
<p>1、给容器中添加了一个组件 RedisOperationsSessionRepository：Redis操作session，session的增删改查封装类；</p>
<p>2、继承 SpringHttpSessionConfiguration 初始化了一个 SessionRepositoryFilter：session 存储过滤器；每个请求过来都必须经过 Filter 组件；创建的时候，自动从容器中获取到了 SessionRepository；</p>
<p> SessionRepositoryFilter：</p>
<p>●将原生的 HttpServletRequest Response 包装成 SessionRepositoryRequestWrapper ResponseWrapper；包装后的对象应用到了后面整个执行链；</p>
<p>●以后获取 request.getSession(); 都会调用 wrappedRequesr.getSession(); 从SessionRepository获取；</p>
<p>3、装饰者模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    request.setAttribute(SESSION_REPOSITORY_ATTR, <span class="built_in">this</span>.sessionRepository);</span><br><span class="line">    SessionRepositoryFilter&lt;S&gt;.<span class="type">SessionRepositoryRequestWrapper</span> <span class="variable">wrappedRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SessionRepositoryFilter</span>.SessionRepositoryRequestWrapper(request, response);</span><br><span class="line">    SessionRepositoryFilter.<span class="type">SessionRepositoryResponseWrapper</span> <span class="variable">wrappedResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SessionRepositoryFilter</span>.SessionRepositoryResponseWrapper(wrappedRequest, response);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        filterChain.doFilter(wrappedRequest, wrappedResponse);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        wrappedRequest.commitSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>目前微服务jwt+aop方式较多?</p>
<p>token机制较多?</p>
<h1 id="SSO-单点登录"><a href="#SSO-单点登录" class="headerlink" title="SSO-单点登录"></a>SSO-单点登录</h1><p>Single Sign On 一处登陆、处处可用</p>
<p>参考：<a target="_blank" rel="noopener" href="https://gitee.com/xuxueli0323/xxl-sso">https://gitee.com/xuxueli0323/xxl-sso</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/12568777/1621678827735-65a003c7-4347-4b66-8eb2-398cc9f582c7.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_19,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" alt="image.png"></p>
<h2 id="单点登录流程"><a href="#单点登录流程" class="headerlink" title="单点登录流程"></a>单点登录流程</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12568777/1621688335508-22964e16-b818-4c06-b74a-7aa168e31711.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_29,text_RXDmtYHoi48=,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10/resize,w_1002,limit_0" alt="单点登录流程.png"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0/" rel="tag"># 视频笔记</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/28/Leetcode%E5%88%B7%E9%A2%98-%E6%95%B0%E7%BB%84-2/" rel="prev" title="Leetcode 数组-2">
      <i class="fa fa-chevron-left"></i> Leetcode 数组-2
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/08/30/Leetcode%20%E9%93%BE%E8%A1%A8-1/" rel="next" title="Leetcode 链表-1">
      Leetcode 链表-1 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1-%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9F%AD%E4%BF%A1-%E7%99%BB%E5%BD%95-%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8Fsession"><span class="nav-number">1.</span> <span class="nav-text">认证服务-验证码短信 登录 注册与分布式session</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">1.1.</span> <span class="nav-text">短信验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%E7%B1%BB-HttpUtils"><span class="nav-number">1.1.1.</span> <span class="nav-text">工具类 HttpUtils</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.2.</span> <span class="nav-text">相关配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">1.1.3.</span> <span class="nav-text">发送验证码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">1.1.4.</span> <span class="nav-text">测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.1.5.</span> <span class="nav-text">发送短信接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E9%98%B2%E5%88%B7%E5%92%8C%E9%AA%8C%E8%AF%81%E7%A0%81%E5%86%8D%E6%AC%A1%E6%A0%A1%E9%AA%8C"><span class="nav-number">1.1.6.</span> <span class="nav-text">接口防刷和验证码再次校验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C"><span class="nav-number">1.2.</span> <span class="nav-text">注册</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BB%E5%BD%95"><span class="nav-number">1.3.</span> <span class="nav-text">登录</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MD5-amp-MD5%E7%9B%90%E5%80%BC%E5%8A%A0%E5%AF%86"><span class="nav-number">2.</span> <span class="nav-text">MD5&amp;MD5盐值加密</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MD5"><span class="nav-number">2.1.</span> <span class="nav-text">MD5</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8"><span class="nav-number">3.</span> <span class="nav-text">异常</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Oauth2-0"><span class="nav-number">4.</span> <span class="nav-text">Oauth2.0</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A5%E5%85%A5%E6%AD%A5%E9%AA%A4"><span class="nav-number">4.1.</span> <span class="nav-text">接入步骤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">5.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Session-%E5%85%B1%E4%BA%AB%E9%97%AE%E9%A2%98"><span class="nav-number">6.</span> <span class="nav-text">Session 共享问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Session-%E5%8E%9F%E7%90%86"><span class="nav-number">6.1.</span> <span class="nav-text">Session 原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B-Session-%E5%85%B1%E4%BA%AB%E9%97%AE%E9%A2%98"><span class="nav-number">6.2.</span> <span class="nav-text">分布式下 Session 共享问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Session-%E5%85%B1%E4%BA%AB%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="nav-number">7.</span> <span class="nav-text">Session 共享问题解决</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Session-%E5%A4%8D%E5%88%B6"><span class="nav-number">7.1.</span> <span class="nav-text">Session 复制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8"><span class="nav-number">7.2.</span> <span class="nav-text">客户端存储</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hash%E4%B8%80%E8%87%B4%E6%80%A7"><span class="nav-number">7.3.</span> <span class="nav-text">hash一致性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%9F%E4%B8%80%E5%AD%98%E5%82%A8"><span class="nav-number">7.4.</span> <span class="nav-text">统一存储</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B4%E5%90%88SpringSession"><span class="nav-number">8.</span> <span class="nav-text">整合SpringSession</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringBoot-%E6%95%B4%E5%90%88-SpringSession"><span class="nav-number">8.1.</span> <span class="nav-text">SpringBoot 整合 SpringSession</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringSession-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="nav-number">8.2.</span> <span class="nav-text">SpringSession 核心原理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SSO-%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95"><span class="nav-number">9.</span> <span class="nav-text">SSO-单点登录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B"><span class="nav-number">9.1.</span> <span class="nav-text">单点登录流程</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jupiter</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jupiter223" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jupiter223" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:oneway8835@gmail.com" title="E-Mail → mailto:oneway8835@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jupiter</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
